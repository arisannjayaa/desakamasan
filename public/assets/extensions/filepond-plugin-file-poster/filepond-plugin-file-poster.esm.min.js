/*!
 * FilePondPluginFilePoster 2.1.0
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const e={type:"spring",stiffness:.5,damping:.45,mass:10},t=(e,t,a=1,i=(e=>-.5*(Math.cos(Math.PI*e)-1)),r=10,o=0)=>{const n=1-o,s=t.join(",");for(let t=0;t<=r;t++){const c=t/r,l=o+n*c;e.addColorStop(l,`rgba(${s}, ${i(c)*a})`)}},a=e=>{const t=Math.min(10/e.width,10/e.height),a=document.createElement("canvas"),r=a.getContext("2d"),o=a.width=Math.ceil(e.width*t),n=a.height=Math.ceil(e.height*t);r.drawImage(e,0,0,o,n);let s=null;try{s=r.getImageData(0,0,o,n).data}catch(e){return null}const c=s.length;let l=0,d=0,E=0,p=0;for(;p<c;p+=4)l+=s[p]*s[p],d+=s[p+1]*s[p+1],E+=s[p+2]*s[p+2];return{r:l=i(l,c),g:d=i(d,c),b:E=i(E,c)}},i=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),r=(e,a,i,r,o)=>{e.width=a,e.height=i;const n=e.getContext("2d"),s=.5*a,c=n.createRadialGradient(s,i+110,i-100,s,i+110,i+100);t(c,r,o,void 0,8,.4),n.save(),n.translate(.5*-a,0),n.scale(2,1),n.fillStyle=c,n.fillRect(0,0,a,i),n.restore()},o="undefined"!=typeof navigator,n=o&&document.createElement("canvas"),s=o&&document.createElement("canvas"),c=o&&document.createElement("canvas");o&&(r(n,500,200,[40,40,40],.85),r(s,500,200,[196,78,71],1),r(c,500,200,[54,151,99],1));const l=t=>{const i=(e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{((e,t)=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)})(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}))(t),r=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},o=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:({root:a,props:r})=>{const o=(t=>t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{const{id:a}=t,i=e.query("GET_ITEM",{id:t.id});if(!i)return;const r=i.getMetadata("poster");e.ref.image.src=r,e.dispatch("DID_FILE_POSTER_DRAW",{id:a})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}}))(t);a.ref.image=a.appendChildView(a.createChildView(o,{id:r.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(i,{template:n,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(i,{template:c,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(i,{template:s,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e})=>{const{image:t}=e.ref;t.scaleX=1,t.scaleY=1,t.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t})=>{const{id:i}=t,r=e.query("GET_ITEM",i);if(!r)return;const o=r.getMetadata("poster"),n=t=>{const o=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?a(t):null;r.setMetadata("color",o,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:i,data:t})};((e,t)=>{let a=new Image;a.onload=(()=>{const e=a.naturalWidth,i=a.naturalHeight;a=null,t(e,i)}),a.src=e})(o,(t,a)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:i,width:t,height:a}),((e,t)=>new Promise((a,i)=>{const r=new Image;"string"==typeof crossOrigin&&(r.crossOrigin=t),r.onload=(()=>{a(r)}),r.onerror=(e=>{i(e)}),r.src=e}))(o,e.query("GET_FILE_POSTER_CROSS_ORIGIN_ATTRIBUTE_VALUE")).then(n)})},DID_THROW_ITEM_LOAD_ERROR:o,DID_THROW_ITEM_PROCESSING_ERROR:o,DID_THROW_ITEM_INVALID:o,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:r,DID_REVERT_ITEM_PROCESSING:r})})},d=e=>{const{addFilter:t,utils:a}=e,{Type:i,createRoute:r}=a,o=l(e);return t("CREATE_VIEW",e=>{const{is:t,view:a,query:i}=e;if(!t("file")||!i("GET_ALLOW_FILE_POSTER"))return;a.registerWriter(r({DID_LOAD_ITEM:({root:e,props:t})=>{const{id:r}=t,n=i("GET_ITEM",r);n&&n.getMetadata("poster")&&!n.archived&&(e.ref.filePoster=a.appendChildView(a.createChildView(o,{id:r})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:r}))},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,action:t})=>{e.ref.imageWidth=t.width,e.ref.imageHeight=t.height,e.ref.shouldUpdatePanelHeight=!0,e.dispatch("KICK")}},({root:e,props:t})=>{e.rect.element.hidden||e.ref.shouldUpdatePanelHeight&&(e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:t.id,height:e.rect.element.width*(e.ref.imageHeight/e.ref.imageWidth)}),e.ref.shouldUpdatePanelHeight=!1)}))}),{options:{allowFilePoster:[!0,i.BOOLEAN],filePosterCalculateAverageImageColor:[!1,i.BOOLEAN],filePosterCrossOriginAttributeValue:["Anonymous",i.STRING]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:d}));export default d;
